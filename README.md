# DetectCMtoLN

---
DetectCMtoLN (Detect Cancer Metastasis to Lymph Nodes) is a project focused on evaluating the use of neural networks to detect cancer metastasis to lymph nodes from histopathological images, based on the PatchCamelyon (PCam) dataset. This repository contains the source code for the project, including model training, testing, and evaluation scripts.

## Project Structure

---
```bash
DetectCMtoLN/
├── att_gconvs
│   ├── ...
├── dataset
│   ├── pcam
├── output
├── src
│   ├── dataset.py
│   ├── pcam_model.py
│   └── utils.py
├── .gitignore
├── environment.yml
├── main.py
└── README.md
```

- **att_gconvs:** This is another GitHub repository that contains custom convolutional layers used in some of the models.
- **dataset:** Directory for storing the PCam dataset. 
  - **pcam:** Contains the raw dataset.
- **output:** Stores the outputs generated by the model.
- **src:** Contains source code files. 
  - **dataset.py:** Script for handling dataset loading and preprocessing. 
  - **pcam_model.py:** Script defining the PCAMModel class used for training and evaluating models. 
  - **utils.py:** Utility functions for the project.
- **main.py:** Main script for running the training and testing of models.

## Setup and Installation

---
### Clone the Repository

```bash
git clone https://github.com/Og4rek/DetectCMtoLN.git
cd DetectCMtoLN
```

### Clone the att_gconvs Repository
```bash
git clone https://github.com/dwromero/att_gconvs.git
```

### Create and Activate Conda Environment

```bash
conda env create -f environment.yml
conda activate detect_cmtoln
```

### Download PCam Dataset

Download the dataset from https://github.com/basveeling/pcam and place it in the dataset/pcam directory.

### Run the Training/Testing Script

```bash
python main.py --model <model_name> --epoch <num_epochs> [other_arguments]
```

#### Example:

```bash
python main.py --model resnet50 --epoch 10 --dataset_path dataset/pcam --output_folder dataset/output
````

#### Usage arguments

    --model: Model type to use (e.g., resnet18, resnet34, resnet50, DenseNet, P4DenseNet, etc.).
    --resnet_freeze: Freeze ResNet layers during training (useful for transfer learning).
    --aug: Use data augmentation.
    --lr: Learning rate for the optimizer.
    --batch_size: Batch size for training.
    --max_lr: Maximum learning rate for OneCycleLR scheduler.
    --epoch: Number of epochs for training.
    --num_workers: Number of workers for data loading.
    --model_path: Path to a pre-trained model checkpoint to continue training or for testing.
    --dataset_path: Path to the dataset directory.
    --output_folder: Directory to save the output results.
    --log_folder: Directory to save the logs.
    --test_model: Only test the given model without training.

## Models

---
The project supports several models described in articles[1][2][3], including:

    ResNet variants: resnet18, resnet34, resnet50, resnet101, resnet152
    Gconv DenseNet variants: DenseNet, P4DenseNet, P4MDenseNet, fA_P4DenseNet, fA_P4MDenseNet

## Bibliography

---
[1] Veeling, Bastiaan S., et al. "Rotation equivariant CNNs for digital pathology." _Medical Image Computing and Computer Assisted Intervention–MICCAI 2018: 21st International Conference, Granada, Spain, September 16-20, 2018, Proceedings, Part II 11._ Springer International Publishing, 2018.

[2] Romero, David, et al. _"Attentive group equivariant convolutional networks." International Conference on Machine Learning._ PMLR, 2020.

[3] Bütün, Ertan, Murat Uçan, and Mehmet Kaya. "Automatic detection of cancer metastasis in lymph node using deep learning." _Biomedical Signal Processing and Control_ 82 (2023): 104564.

## License

---
This project is licensed under the MIT License. See the LICENSE file for more details.

## Acknowledgements

---
I would like to thank the authors of the PCam dataset and the contributors to the att_gconvs repository for their valuable resources.

For any questions or issues, please open an issue on the GitHub repository.